- name: Check existing version
  ansible.builtin.command: go version
  register: cver

- name: Install new version of go
  block:
    - name: Download go tar file
      command: wget https://go.dev/dl/go{{goversion}}.linux-amd64.tar.gz

    - name: Extract and move new go folder to /usr/local
      command: tar -C /usr/lib/go-{{goversion}} -xzf go{{goversion}}.linux-amd64.tar.gz
      become: true

    - name: Delete downloaded tar file
      shell: rm -rf go{{goversion}}.linux-amd64.tar.gz*
  when: cver != "go version go{{goversion}} linux/amd64"